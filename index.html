<!DOCTYPE html>
<html>
<head>
    <title>软件工程实践大作业</title>
    <link rel="icon" href="./images/logo.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
        }
        h2 {
            background-color: #460099;
            color: #fff;
            padding: 10px 0;
            margin: 0;
            text-align: center;
        }
        #student {
            margin: 20px 0;
            font-size: 20px;
            text-align: center;
        }
        #studentName {
            display: inline-block;
            width: 200px; 
            height: 30px; 
            padding: 5px;  
            border: none;  
            border-radius: 5px;  
            font-size: 16px;  
        }

        #searchBox {
            position: absolute;
            top: 30px;
            right: 50px;
            padding: 20px;
        }
        #searchStudent {
            background-color: #007BFF;  
            color: #fff;  
            border: none;  
            border-radius: 5px;  
            padding: 5px 10px;  
            font-size: 16px;  
            cursor: pointer;  
        }

        #searchStudent:hover {
            background-color: #0056b3;  
        }
        #studentName, #searchButton {
            display: inline-block;
        }
        button {
            display: block;
            width: 200px;
            height: 40px;
            margin: 10px auto;
            font-size: 18px;
            color: #fff;
            background-color: #460099;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #searchButton {
            width: 90px;  
            height: 30px;  
        }
        button:hover {
            background-color: #0056b3;
        }
        table {
            width: 100%;
            margin-bottom: 20px;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ccc;
            text-align: left;
            padding: 10px;
            text-align: center; 
            vertical-align: middle; 
        }
        th {
            background-color: #460099;
            color: #fff;
            text-align: center; 
            vertical-align: middle; 
        }
        img {
            display: none;
            margin: 10px auto;
            border-radius: 50%;

        }
    </style>
</head>
<body>
    <h2>软件工程实践大作业——课堂点名软件</h2>
    <button onclick="callName()">点名</button>
    <button onclick="markAttendance(currentStudent, true)">出席</button>
    <button onclick="markAttendance(currentStudent, false)">缺席</button>
    <button onclick="exportToXls()">导出</button>
    <div id="searchBox">
        <input id="studentName" type="text" placeholder="请输入学生姓名">
        <button id="searchButton" onclick="searchStudent()">搜索学生</button>
    </div>
    <p id="student"></p>
    <table id="attendance">
        <tr>
            <th>学号</th>
            <th>学生姓名</th>
            <th>出勤情况</th>
        </tr>
    <img id="photo" src="" alt="学生照片" width="200" height="200" style="display: none; margin: 10px auto;">
    
    </table>

    <script>
        var date =new Date();
        var dateString = date.getFullYear() + '.' + (date.getMonth() + 1) + '.' + date.getDate();
        var students = ["学生1", "学生2", "学生3", "学生4", "学生5","学生6", "学生7", "学生8", "学生9", "学生10","学生11", "学生12", "学生13", "学生14", "学生15"];
        var studentIds = ["502023230001", "502023230002", "502023230003", "502023230004", "502023230005","502023230006",
         "502023230007", "502023230008", "502023230009", "502023230010","502023230011", "502023230012", "502023230013", "502023230014", "502023230015"];
        var photos = ["images/徐德军.jpg", "images/王凯.jpg", "images/张世坤.jpg", "学生4.jpg", "学生5.jpg"];
        var photo = document.getElementById("photo");
        var current = 0;
        var currentStudent = "";

        // 初始化出勤表格
        var table = document.getElementById("attendance");
        for (var i = 0; i < students.length; i++) {
            var row = table.insertRow(-1);
            row.insertCell(0).innerHTML = studentIds[i];
            row.insertCell(1).innerHTML = students[i];
            row.insertCell(2).innerHTML = "未点名";
        }

        //导出出勤表
        function exportToXls() {
            // 创建一个CSV字符串
            var csv = '学号，姓名，出勤情况\n';
            for (var i = 1; i < table.rows.length; i++) {
                csv += table.rows[i].cells[0].innerHTML + ' ' + table.rows[i].cells[1].innerHTML + ' ' +table.rows[i].cells[2].innerHTML + '\n';
            }
            // 创建一个Blob对象
            var blob = new Blob([csv], {type: 'data:application/vnd.ms-excel'});
            // 创建一个可以下载的URL
            var url = URL.createObjectURL(blob);
            // 创建一个隐藏的下载链接
            var link = document.createElement("a");
            link.href = url;
            // 获取当前日期
            link.download = "出勤记录-" + dateString + ".xls";
            link.style.display = "none";
            document.body.appendChild(link);
            // 触发下载
            link.click();
            // 移除下载链接w
            document.body.removeChild(link);
        }

        function callName() {
            if (current >= students.length) {
                current = 0;
            }
            currentStudent = students[current];
            document.getElementById("student").innerHTML = currentStudent;
            current = current +1;
            photo.src = photos[current - 1];
            photo.style.display = "block";
            var utterance = new SpeechSynthesisUtterance(currentStudent);
            window.speechSynthesis.speak(utterance);
        }

        function markAttendance(student, isPresent) {
            // 找到学生在表格中的行
            for (var i = 1; i < table.rows.length; i++) {
                if (table.rows[i].cells[1].innerHTML == student) {
                    // 记录出勤情况
                    table.rows[i].cells[2].innerHTML = isPresent ? "出席" : "缺席";
                    break;
                }
            }
        }
        
        //查找
        function searchStudent() {
            var student = document.getElementById("studentName").value;
            var found = false;
            for (var i = 1; i < table.rows.length; i++) {
                if (table.rows[i].cells[1].innerHTML == student) {
                    currentStudent = student;
                    var utterance = new SpeechSynthesisUtterance(currentStudent);
                    window.speechSynthesis.speak(utterance);
                    document.getElementById("student").innerHTML = currentStudent;
                    photo.src = photos[i - 1];
                    photo.style.display = "block";
                    found = true;
                    break;
                }
            }
            if (!found) {
                alert("未找到该学生");
            }
        }      

    </script>
</body>
</html>